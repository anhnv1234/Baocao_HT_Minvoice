<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√°o C√°o Monitor VIP Pro V14.8 - All Channels (LIVE)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    
    <style>
        /* === CORE VARIABLES === */
        :root {
            --bg-dark: #0f1115;
            --bg-card: #181b21;
            --text-main: #e0e0e0;
            --text-muted: #6c757d;
            --accent: #00e396; /* Xanh l√° */
            --danger: #ff4560; /* ƒê·ªè */
            --warning: #feb019; /* V√†ng */
            --info: #008ffb;    /* Xanh d∆∞∆°ng */
            --miss: #d63384;    /* M√†u h·ªìng ƒë·∫≠m */
            --miss-yellow: #fbc02d; /* M√†u v√†ng m·ªõi cho Miss */
            --border: #2b3139;
            --nav-height: 70px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-main); font-size: 14px; }

        /* === LOADING SPINNER (NEW) === */
        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center; backdrop-filter: blur(5px);
            display: none; 
        }
        .loader { border: 5px solid #f3f3f3; border-top: 5px solid var(--accent); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* HEADER */
        .top-navbar { height: var(--nav-height); background: var(--bg-card); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; position: sticky; top: 0; z-index: 1000; }
        .nav-logo { font-size: 20px; font-weight: 800; color: #fff; display: flex; align-items: center; gap: 10px; text-transform: uppercase; letter-spacing: 1px; }

        .date-filter-group { display: flex; align-items: center; gap: 10px; background: #232832; padding: 5px 15px; border-radius: 6px; border: 1px solid var(--border); }
        .date-input { background: transparent; border: 1px solid #444; color: #fff; padding: 5px 10px; border-radius: 4px; font-family: 'Inter'; font-size: 13px; color-scheme: dark; }
        .btn-filter { background: var(--info); color: #fff; border: none; padding: 8px 18px; border-radius: 4px; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn-filter:hover { background: #1a4bd6; transform: translateY(-1px); }

        .container { max-width: 1800px; margin: 20px auto; padding: 0 20px; display: flex; flex-direction: column; gap: 20px; }
        .section-title { color: #fff; font-size: 16px; font-weight: 800; text-transform: uppercase; border-left: 5px solid var(--accent); padding-left: 12px; margin: 25px 0 15px 0; display: flex; align-items: center; }

        /* KPI GRID */
        .kpi-wrapper { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; }
        .kpi-box { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 15px 20px; display: flex; flex-direction: column; justify-content: space-between; min-height: 120px; transition: all 0.3s; }
        .kpi-box:hover { border-color: var(--info); transform: translateY(-2px); }
        .kpi-head { font-size: 12px; color: var(--text-muted); text-transform: uppercase; font-weight: 700; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
        .kpi-main-val { font-size: 28px; font-weight: 800; color: #fff; margin-bottom: 5px; line-height: 1.2; }
        .kpi-footer { font-size: 12px; font-weight: 500; display: flex; flex-direction: column; gap: 4px; margin-top: auto; padding-top: 10px; border-top: 1px dashed #333; }
        .stat-row { display: flex; justify-content: space-between; align-items: center; }
        .trend-up { color: var(--accent); } .trend-down { color: var(--danger); } .trend-neutral { color: var(--text-muted); }
        
        .c-in { color: var(--info); } .c-out { color: var(--warning); } .c-sla { color: var(--danger); } .c-miss { color: var(--miss); }
        .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .dot-in { background: var(--info); } .dot-out { background: var(--warning); } .dot-sla { background: var(--danger); } .dot-miss { background: var(--miss); }

        /* OVERVIEW CHARTS */
        .overview-charts-wrapper { display: grid; grid-template-columns: 1fr 1.5fr 1.5fr; gap: 20px; }
        .overview-chart-box { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 20px; height: 380px; display: flex; flex-direction: column; }
        .chart-box-title { font-size: 14px; font-weight: 700; color: #fff; text-transform: uppercase; margin-bottom: 15px; }
        .chart-content { flex: 1; position: relative; width: 100%; min-height: 0; }

        /* PRODUCT GRID V2 */
        .product-grid-v2 { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-bottom: 25px; }
        .pro-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 20px; display: flex; flex-direction: column; gap: 15px; transition: all 0.2s; }
        .pro-card.active { border: 1px solid var(--accent); box-shadow: 0 0 15px rgba(0, 227, 150, 0.15); }
        .pro-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .pro-title { font-size: 15px; font-weight: 800; color: #848e9c; text-transform: uppercase; letter-spacing: 0.5px; }
        .pro-growth { font-size: 13px; font-weight: 700; }
        .growth-down { color: var(--danger); } .growth-up { color: var(--accent); } .growth-neu { color: var(--text-muted); }
        .pro-stat-row { display: flex; justify-content: space-between; align-items: center; font-size: 15px; font-weight: 600; color: #fff; }
        .pro-label { display: flex; align-items: center; gap: 10px; color: #b0b3b8; font-weight: 500; }
        .p-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .pd-blue { background-color: var(--info); } .pd-orange { background-color: var(--warning); } .pd-red { background-color: var(--danger); }
        .pro-footer { margin-top: auto; padding-top: 15px; border-top: 1px solid #2b3139; display: flex; justify-content: space-between; align-items: center; }
        .pro-total-label { font-size: 14px; font-weight: 700; color: #fff; text-transform: uppercase; }
        .pro-total-val { font-size: 24px; font-weight: 800; color: #fff; }
        .waiting-card { border: 1px dashed #444; opacity: 0.7; }
        .waiting-text { font-style: italic; color: #555; text-align: center; width: 100%; margin-top: 20px; }

        /* === SUBIZ PRO DASHBOARD === */
        .subiz-dashboard {
            display: grid;
            grid-template-columns: 1.2fr 1.8fr 1fr;
            gap: 20px;
        }
        .sd-card {
            background: #1e222b;
            border-radius: 12px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        .sd-card:hover { transform: translateY(-3px); border-color: #444; }

        /* Styles for Part III */
        .sd-master { background: linear-gradient(160deg, #1e222b 0%, #151020 100%); border-top: 4px solid #775dd0; }
        .sd-icon-big { font-size: 40px; margin-bottom: 10px; }
        .sd-title { font-size: 14px; color: #aaa; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        .sd-val-group { display: flex; align-items: baseline; gap: 15px; margin: 10px 0; }
        .sd-val-big { font-size: 48px; font-weight: 800; color: #fff; line-height: 1.1; }
        .sd-badge { display: inline-block; background: rgba(119, 93, 208, 0.2); color: #bca0ff; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; width: fit-content; }

        /* Growth Badge Style */
        .g-badge { font-size: 14px; font-weight: 700; padding: 4px 10px; border-radius: 6px; display: flex; align-items: center; gap: 5px; }
        .g-up { background: rgba(0, 227, 150, 0.15); color: #00e396; }
        .g-down { background: rgba(255, 69, 96, 0.15); color: #ff4560; }

        .sd-detail { display: flex; flex-direction: column; justify-content: space-between; border-top: 4px solid var(--info); }
        .sd-split-row { display: flex; gap: 20px; height: 100%; align-items: center; }
        .sd-half { flex: 1; background: rgba(255,255,255,0.03); padding: 15px; border-radius: 8px; text-align: center; height: 100%; display: flex; flex-direction: column; justify-content: center; }
        .sd-val-med { font-size: 32px; font-weight: 700; color: #fff; margin: 5px 0; }
        .sd-sub-label { font-size: 13px; color: #848e9c; text-transform: uppercase; font-weight: 600; }
        
        .sd-warning { border-top: 4px solid var(--danger); background: linear-gradient(160deg, #1e222b 0%, #201015 100%); }
        .warn-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed rgba(255, 69, 96, 0.3); }
        .warn-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .warn-val-group { text-align: right; }
        .warn-val { font-size: 20px; font-weight: 700; color: #fff; }
        .warn-growth { font-size: 11px; font-weight: 600; margin-top: 2px; }
        .w-miss { color: var(--miss); } .w-sla { color: var(--danger); }

        /* === CHART SECTION STYLES === */
        .middle-charts-row { width: 100%; }
        
        .performance-chart-box { 
            background: var(--bg-card); 
            border: 1px solid var(--border); 
            border-radius: 12px; 
            padding: 25px; 
            display: flex; 
            flex-direction: column;
            min-height: 450px; 
        }

        .chart-split-wrapper { 
            display: flex; 
            gap: 15px; 
            height: 350px; 
            width: 100%; 
        }
        
        .chart-split-item { 
            position: relative; 
            flex: 1; 
            min-width: 0; 
            height: 100%; 
        }
        
        .chart-split-item:first-child { flex: 2.5; border-right: 1px dashed #333; padding-right: 15px; }
        .chart-split-item:last-child { flex: 1; padding-left: 5px; }

        .bottom-charts-row { display: grid; grid-template-columns: 2.5fr 1fr; gap: 20px; margin-top: 20px; }
        
        .chart-container-fixed { 
            position: relative; 
            height: 350px; 
            width: 100%; 
        } 
        
        .badge-live { background: rgba(0, 227, 150, 0.2); color: var(--accent); padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: bold; }

        /* === EMPLOYEE TABLE STYLES === */
        .employee-section { margin-top: 25px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 25px; }
        .emp-table-wrapper { overflow-x: auto; margin-top: 15px; }
        .emp-table { width: 100%; border-collapse: collapse; min-width: 800px; }
        .emp-table th { text-align: left; padding: 15px; color: #848e9c; font-size: 12px; text-transform: uppercase; border-bottom: 2px solid #2b3139; background: #1a1e26; }
        .emp-table td { padding: 15px; border-bottom: 1px solid #2b3139; font-size: 14px; font-weight: 500; vertical-align: middle; }
        .emp-table tr:hover { background: rgba(255,255,255,0.02); }
        .emp-name { display: flex; align-items: center; gap: 10px; font-weight: 700; color: #fff; }
        .emp-avatar { width: 32px; height: 32px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #aaa; border: 1px solid #555; }
        
        /* Progress Bar Style */
        .progress-wrapper { width: 100%; display: flex; align-items: center; gap: 10px; }
        .progress-bg { flex: 1; height: 8px; background: #333; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease; position: relative; }
        .progress-fill.high { background: var(--accent); }
        .progress-fill.med { background: var(--info); }
        .progress-fill.low { background: var(--warning); }
        .progress-val { font-size: 12px; font-weight: 700; min-width: 40px; text-align: right; }

        .tag { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; display: inline-block; min-width: 30px; text-align: center;}
        .tag-in { color: var(--info); background: rgba(0, 143, 251, 0.15); }
        .tag-out { color: var(--warning); background: rgba(254, 176, 25, 0.15); }
        .tag-miss { color: var(--miss-yellow); background: rgba(251, 192, 45, 0.15); }
        .tag-sla { color: var(--danger); background: rgba(255, 69, 96, 0.15); }

        /* Call Center Stats */
        .call-stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
        .call-stat-card { background: #1e222b; border: 1px solid #333; border-radius: 8px; padding: 20px; display: flex; align-items: center; gap: 15px; }
        .call-icon { width: 50px; height: 50px; background: rgba(255,255,255,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .call-info h4 { color: #848e9c; font-size: 12px; text-transform: uppercase; margin-bottom: 5px; }
        .call-info .val { font-size: 22px; font-weight: 800; color: #fff; }
        .call-info .sub { font-size: 11px; color: #555; }

        @media (max-width: 1400px) { 
            .product-grid-v2 { grid-template-columns: repeat(3, 1fr); } 
            .overview-charts-wrapper { grid-template-columns: 1fr; height: auto; }
            .overview-chart-box { height: 300px; margin-bottom: 20px; }
            .bottom-charts-row { grid-template-columns: 1fr; }
            .chart-split-wrapper { flex-direction: column; height: auto; } 
            .chart-split-item:first-child { border-right: none; border-bottom: 1px dashed #333; padding-right: 0; padding-bottom: 15px; margin-bottom: 15px; height: 300px; }
            .chart-split-item:last-child { padding-left: 0; height: 300px; }
            .subiz-dashboard, .call-stat-grid { grid-template-columns: 1fr; }
            .sd-split-row { flex-direction: row; }
        }
        @media (max-width: 992px) { .product-grid-v2 { grid-template-columns: repeat(2, 1fr); } .kpi-wrapper { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { 
            .product-grid-v2, .kpi-wrapper { grid-template-columns: 1fr; }
            .top-navbar { flex-direction: column; height: auto; padding: 15px; gap: 10px; align-items: flex-start; }
            .date-filter-group { width: 100%; }
            .sd-split-row { flex-direction: column; }
        }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div class="loader"></div>
    <div style="color: #fff; font-weight: bold; font-size: 16px;">ƒê·ªá ƒëang l·∫•y b√°o c√°o t·ªïng h·ª£p, ƒë·ª£i t√≠...</div>
</div>

<header class="top-navbar">
    <div class="nav-left">
        <div class="nav-logo">
            <span style="font-size: 26px;">üöÄ</span> B√ÅO C√ÅO MONITOR V14.8
        </div>
    </div>
    <div class="date-filter-group">
        <span style="color: #848e9c; font-size: 13px; font-weight: 600;">PH·∫†M VI:</span>
        <input type="date" id="dateFrom" class="date-input">
        <span style="color:#fff">‚ûù</span>
        <input type="date" id="dateTo" class="date-input">
        <button class="btn-filter" onclick="fetchGroupData()">L·ªåC D·ªÆ LI·ªÜU</button>
    </div>
</header>

<div class="container">
    <div class="section-title">I. T·ªîNG QUAN HI·ªÜU SU·∫§T</div>
    
    <div class="kpi-wrapper">
        <div class="kpi-box" style="border-left: 4px solid var(--info);">
            <div class="kpi-head"><span>üìÇ T·ªïng Ticket Chat</span></div>
            <div class="kpi-main-val" id="k-chat-total">0</div>
            <div class="kpi-footer" id="f-chat-total"></div>
        </div>
        <div class="kpi-box">
            <div class="kpi-head"><span>‚òÄÔ∏è Ticket Trong Gi·ªù</span> <span class="dot dot-in"></span></div>
            <div class="kpi-main-val" id="k-chat-in">0</div>
            <div class="kpi-footer" id="f-chat-in"></div>
        </div>
        <div class="kpi-box">
            <div class="kpi-head"><span>üåô Ticket Ngo√†i Gi·ªù</span> <span class="dot dot-out"></span></div>
            <div class="kpi-main-val" id="k-chat-out">0</div>
            <div class="kpi-footer" id="f-chat-out"></div>
        </div>
        <div class="kpi-box">
            <div class="kpi-head"><span>‚ö†Ô∏è Qu√° SLA Ticket</span> <span class="dot dot-sla"></span></div>
            <div class="kpi-main-val c-sla" id="k-chat-sla">0</div>
            <div class="kpi-footer" id="f-chat-sla"></div>
        </div>
        <div class="kpi-box" style="border: 1px dashed var(--miss);">
            <div class="kpi-head"><span>üö´ Miss Chat Ticket</span> <span class="dot dot-miss"></span></div>
            <div class="kpi-main-val c-miss" id="k-chat-miss">0</div>
            <div class="kpi-footer" id="f-chat-miss"></div>
        </div>

        <div class="kpi-box" style="border-left: 4px solid var(--info);">
            <div class="kpi-head"><span>üí¨ T·ªïng Zalo Chat</span></div>
            <div class="kpi-main-val" id="k-zalo-total">0</div>
            <div class="kpi-footer" id="f-zalo-total"></div>
        </div>
        <div class="kpi-box">
            <div class="kpi-head"><span>‚òÄÔ∏è Zalo Trong Gi·ªù</span> <span class="dot dot-in"></span></div>
            <div class="kpi-main-val" id="k-zalo-in">0</div>
            <div class="kpi-footer" id="f-zalo-in"></div>
       </div>
       <div class="kpi-box">
           <div class="kpi-head"><span>üåô Zalo Ngo√†i Gi·ªù</span> <span class="dot dot-out"></span></div>
           <div class="kpi-main-val" id="k-zalo-out">0</div>
           <div class="kpi-footer" id="f-zalo-out"></div>
      </div>
       <div class="kpi-box">
           <div class="kpi-head"><span>‚ö†Ô∏è Qu√° SLA Zalo</span> <span class="dot dot-sla"></span></div>
           <div class="kpi-main-val c-sla" id="k-zalo-sla">0</div>
           <div class="kpi-footer" id="f-zalo-sla"></div>
       </div>
       <div class="kpi-box" style="border: 1px dashed var(--miss);">
           <div class="kpi-head"><span>üö´ Miss Chat Zalo</span> <span class="dot dot-miss"></span></div>
           <div class="kpi-main-val c-miss" id="k-zalo-miss">0</div>
           <div class="kpi-footer" id="f-zalo-miss"></div>
       </div>

       <div class="kpi-box">
            <div class="kpi-head"><span>üìû G·ªçi V√†o (Trong Gi·ªù)</span> <span class="dot dot-in"></span></div>
            <div class="kpi-main-val c-in" id="k-call-in-in">0</div>
            <div class="kpi-footer" id="f-call-in-in"></div>
        </div>
        <div class="kpi-box">
            <div class="kpi-head"><span>üìû G·ªçi V√†o (Ngo√†i Gi·ªù)</span> <span class="dot dot-out"></span></div>
            <div class="kpi-main-val c-out" id="k-call-in-out">0</div>
            <div class="kpi-footer" id="f-call-in-out"></div>
        </div>
        <div class="kpi-box">
            <div class="kpi-head"><span>üì≤ G·ªçi Ra (Trong Gi·ªù)</span> <span class="dot dot-in"></span></div>
            <div class="kpi-main-val c-in" id="k-call-out-in">0</div>
            <div class="kpi-footer" id="f-call-out-in"></div>
        </div>
        <div class="kpi-box">
            <div class="kpi-head"><span>üì≤ G·ªçi Ra (Ngo√†i Gi·ªù)</span> <span class="dot dot-out"></span></div>
            <div class="kpi-main-val c-out" id="k-call-out-out">0</div>
            <div class="kpi-footer" id="f-call-out-out"></div>
        </div>
        <div class="kpi-box" style="border: 1px dashed var(--miss);">
            <div class="kpi-head"><span>üìµ G·ªçi Nh·ª° T·ªïng ƒê√†i</span> <span class="dot dot-miss"></span></div>
            <div class="kpi-main-val c-miss" id="k-call-miss">0</div>
            <div class="kpi-footer" id="f-call-miss"></div>
        </div>
    </div>

    <div class="overview-charts-wrapper" style="margin-top: 25px;">
        <div class="overview-chart-box">
            <div class="chart-box-title"><span>üç© T·ª∑ Tr·ªçng K√™nh</span></div>
            <div class="chart-content"><canvas id="overviewDonutChart"></canvas></div>
        </div>
        <div class="overview-chart-box">
            <div class="chart-box-title"><span>üìä Ph√¢n B·ªï Th·ªùi Gian & SLA (Chat)</span></div>
            <div class="chart-content"><canvas id="overviewBarChart"></canvas></div>
        </div>
        <div class="overview-chart-box">
            <div class="chart-box-title"><span>üéß Chi Ti·∫øt T·ªïng ƒê√†i (In/Out/Miss)</span></div>
            <div class="chart-content"><canvas id="callCenterChart"></canvas></div>
        </div>
    </div>

    <div class="section-title">II. CHI TI·∫æT S·∫¢N PH·∫®M & BI·ªÇU ƒê·ªí PH√ÇN T√çCH</div>
    
    <div class="product-grid-v2" id="productGrid"></div>

    <div class="middle-charts-row">
        <div class="performance-chart-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <div class="section-title" style="border:none; padding:0; margin:0;">üìà HI·ªÜU SU·∫§T T·ªîNG H·ª¢P (AUTO SCALE)</div>
                <div class="badge-live">Live Data</div>
            </div>
            <div class="chart-split-wrapper">
                <div class="chart-split-item"><canvas id="generalDailyChart"></canvas></div>
                <div class="chart-split-item"><canvas id="generalPieChart"></canvas></div>
            </div>
        </div>
    </div>

    <div class="bottom-charts-row">
        <div class="performance-chart-box">
             <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <div class="section-title" style="border:none; padding:0; margin:0;">üìä CHI TI·∫æT S·∫¢N PH·∫®M THEO NG√ÄY</div>
                <div class="badge-live">Product Details</div>
            </div>
            <div class="chart-container-fixed"><canvas id="productDailyChart"></canvas></div>
        </div>
        <div class="performance-chart-box">
            <div class="chart-box-title" style="margin-bottom:15px; border-left: 4px solid #feb019; padding-left: 10px;">üç∞ T·ª∂ TR·ªåNG S·∫¢N PH·∫®M</div>
            <div class="chart-content"><canvas id="productPieChart"></canvas></div>
        </div>
    </div>

    <div class="section-title">III. PH√ÇN T√çCH K√äNH SUBIZ & NH√ÇN S·ª∞</div>
    <div class="subiz-dashboard">
        <div class="sd-card sd-master">
            <div class="sd-icon-big">üöÄ</div>
            <div class="sd-title">T·ªïng Ticket Ti·∫øp Nh·∫≠n</div>
            <div class="sd-val-group">
                <div class="sd-val-big" id="sb-total">0</div>
                <div class="g-badge" id="g-total"></div> </div>
            <div class="sd-badge">Subiz Channel</div>
        </div>
        <div class="sd-card sd-detail">
            <div class="sd-split-row">
                <div class="sd-half">
                    <div style="color:var(--info); font-size:20px;">‚òÄÔ∏è</div>
                    <div class="sd-val-med" id="sb-in" style="color:var(--info)">0</div>
                    <div class="g-badge" id="g-in" style="justify-content:center; margin-bottom:5px;"></div> <div class="sd-sub-label">Trong Gi·ªù</div>
                </div>
                <div style="width:1px; background:#333; height:80%;"></div>
                <div class="sd-half">
                    <div style="color:var(--warning); font-size:20px;">üåô</div>
                    <div class="sd-val-med" id="sb-out" style="color:var(--warning)">0</div>
                    <div class="g-badge" id="g-out" style="justify-content:center; margin-bottom:5px;"></div> <div class="sd-sub-label">Ngo√†i Gi·ªù</div>
                </div>
            </div>
        </div>
        <div class="sd-card sd-warning">
            <div class="chart-box-title" style="color:#ff4560; margin-bottom:20px;">‚ö†Ô∏è C·∫¢NH B√ÅO R·ª¶I RO</div>
            <div class="warn-row">
                <div><div style="font-size:12px; color:#aaa;">MISS (TRONG/NGO√ÄI)</div></div>
                <div class="warn-val-group">
                    <div class="warn-val w-miss"><span id="sb-miss-in">0</span> / <span id="sb-miss-out">0</span></div>
                    <div class="warn-growth" id="g-miss" style="color:#aaa">--</div>
                </div>
            </div>
            <div class="warn-row">
                <div><div style="font-size:12px; color:#aaa;">QU√Å SLA (TRONG/NGO√ÄI)</div></div>
                <div class="warn-val-group">
                    <div class="warn-val w-sla"><span id="sb-sla-in">0</span> / <span id="sb-sla-out">0</span></div>
                     <div class="warn-growth" id="g-sla" style="color:#aaa">--</div>
                </div>
            </div>
        </div>
    </div>
    <div class="performance-chart-box" style="margin-top: 25px;">
        <div class="chart-box-title" style="border-left: 4px solid #d63384; padding-left: 10px;">
            ‚ö†Ô∏è PH√ÇN T√çCH ƒêI·ªÇM N√ìNG: MISS & QU√Å SLA (NG√ÄY vs GI·ªú)
        </div>
        <div class="chart-content" style="height: 400px;">
            <canvas id="missSlaScatterChart"></canvas>
        </div>
    </div>
    <div class="employee-section">
        <div class="chart-box-title" style="border-left: 4px solid #775dd0; padding-left: 10px;">üèÜ TH·ªêNG K√ä HI·ªÜU SU·∫§T NH√ÇN VI√äN (SUBIZ)</div>
        <div class="emp-table-wrapper">
            <table class="emp-table">
                <thead>
                    <tr>
                        <th style="width: 200px">T√™n Nh√¢n Vi√™n</th>
                        <th style="text-align: center">T·ªïng S·ªë</th>
                        <th style="text-align: center">Trong Gi·ªù</th>
                        <th style="text-align: center">Ngo√†i Gi·ªù</th>
                        <th style="text-align: center">Qu√° SLA</th>
                        <th style="width: 250px;">T·ª∑ Tr·ªçng ƒê√≥ng G√≥p</th>
                    </tr>
                </thead>
                <tbody id="emp-table-body-subiz"></tbody>
            </table>
        </div>
    </div>

    <div class="section-title">IV. PH√ÇN T√çCH K√äNH ZALO & NH√ÇN S·ª∞</div>
    <div class="subiz-dashboard">
        <div class="sd-card sd-master" style="border-top-color: #008ffb;">
            <div class="sd-icon-big">üí¨</div>
            <div class="sd-title">T·ªïng Zalo Ti·∫øp Nh·∫≠n</div>
            <div class="sd-val-group">
                <div class="sd-val-big" id="zl-total">0</div>
                <div class="g-badge" id="g-zl-total"></div> </div>
            <div class="sd-badge" style="color: #008ffb; background: rgba(0,143,251,0.2);">Zalo Official</div>
        </div>
        <div class="sd-card sd-detail">
            <div class="sd-split-row">
                <div class="sd-half">
                    <div style="color:var(--info); font-size:20px;">‚òÄÔ∏è</div>
                    <div class="sd-val-med" id="zl-in" style="color:var(--info)">0</div>
                    <div class="g-badge" id="g-zl-in" style="justify-content:center; margin-bottom:5px;"></div> <div class="sd-sub-label">Trong Gi·ªù</div>
                </div>
                <div style="width:1px; background:#333; height:80%;"></div>
                <div class="sd-half">
                    <div style="color:var(--warning); font-size:20px;">üåô</div>
                    <div class="sd-val-med" id="zl-out" style="color:var(--warning)">0</div>
                    <div class="g-badge" id="g-zl-out" style="justify-content:center; margin-bottom:5px;"></div> <div class="sd-sub-label">Ngo√†i Gi·ªù</div>
                </div>
            </div>
        </div>
        <div class="sd-card sd-warning">
            <div class="chart-box-title" style="color:#ff4560; margin-bottom:20px;">‚ö†Ô∏è C·∫¢NH B√ÅO R·ª¶I RO</div>
            <div class="warn-row">
                <div><div style="font-size:12px; color:#aaa;">MISS (TRONG/NGO√ÄI)</div></div>
                <div class="warn-val-group">
                    <div class="warn-val w-miss"><span id="zl-miss-in">0</span> / <span id="zl-miss-out">0</span></div>
                    <div class="warn-growth" id="g-zl-miss" style="color:#aaa">--</div>
                </div>
            </div>
            <div class="warn-row">
                <div><div style="font-size:12px; color:#aaa;">QU√Å SLA (TRONG/NGO√ÄI)</div></div>
                <div class="warn-val-group">
                    <div class="warn-val w-sla"><span id="zl-sla-in">0</span> / <span id="zl-sla-out">0</span></div>
                     <div class="warn-growth" id="g-zl-sla" style="color:#aaa">--</div>
                </div>
            </div>
        </div>
    </div>
    <div class="performance-chart-box" style="margin-top: 25px;">
        <div class="chart-box-title" style="border-left: 4px solid #008ffb; padding-left: 10px;">
            ‚ö†Ô∏è PH√ÇN T√çCH ƒêI·ªÇM N√ìNG ZALO (NG√ÄY vs GI·ªú)
        </div>
        <div class="chart-content" style="height: 400px;">
            <canvas id="zaloMissSlaScatterChart"></canvas>
        </div>
    </div>
    <div class="employee-section">
        <div class="chart-box-title" style="border-left: 4px solid #008ffb; padding-left: 10px;">üèÜ TH·ªêNG K√ä HI·ªÜU SU·∫§T NH√ÇN VI√äN (ZALO)</div>
        <div class="emp-table-wrapper">
            <table class="emp-table">
                <thead>
                    <tr>
                        <th style="width: 200px">T√™n Nh√¢n Vi√™n</th>
                        <th style="text-align: center">T·ªïng S·ªë</th>
                        <th style="text-align: center">Trong Gi·ªù</th>
                        <th style="text-align: center">Ngo√†i Gi·ªù</th>
                        <th style="text-align: center">Qu√° SLA</th>
                        <th style="width: 250px;">T·ª∑ Tr·ªçng ƒê√≥ng G√≥p</th>
                    </tr>
                </thead>
                <tbody id="emp-table-body-zalo"></tbody>
            </table>
        </div>
    </div>

    <div class="section-title">V. PH√ÇN T√çCH K√äNH BHXH & NH√ÇN S·ª∞</div>
    <div class="subiz-dashboard">
        <div class="sd-card sd-master" style="border-top-color: #feb019;">
            <div class="sd-icon-big">üõ°Ô∏è</div>
            <div class="sd-title">T·ªïng Ticket BHXH</div>
            <div class="sd-val-group">
                <div class="sd-val-big" id="bh-total">0</div>
                <div class="g-badge" id="g-bh-total"></div> </div>
            <div class="sd-badge" style="color: #feb019; background: rgba(254,176,25,0.2);">BHXH Support</div>
        </div>
        <div class="sd-card sd-detail">
            <div class="sd-split-row">
                <div class="sd-half">
                    <div style="color:var(--info); font-size:20px;">‚òÄÔ∏è</div>
                    <div class="sd-val-med" id="bh-in" style="color:var(--info)">0</div>
                    <div class="g-badge" id="g-bh-in" style="justify-content:center; margin-bottom:5px;"></div> <div class="sd-sub-label">Trong Gi·ªù</div>
                </div>
                <div style="width:1px; background:#333; height:80%;"></div>
                <div class="sd-half">
                    <div style="color:var(--warning); font-size:20px;">üåô</div>
                    <div class="sd-val-med" id="bh-out" style="color:var(--warning)">0</div>
                    <div class="g-badge" id="g-bh-out" style="justify-content:center; margin-bottom:5px;"></div> <div class="sd-sub-label">Ngo√†i Gi·ªù</div>
                </div>
            </div>
        </div>
        <div class="sd-card sd-warning">
            <div class="chart-box-title" style="color:#ff4560; margin-bottom:20px;">‚ö†Ô∏è C·∫¢NH B√ÅO R·ª¶I RO</div>
            <div class="warn-row">
                <div><div style="font-size:12px; color:#aaa;">MISS (TRONG/NGO√ÄI)</div></div>
                <div class="warn-val-group">
                    <div class="warn-val w-miss"><span id="bh-miss-in">0</span> / <span id="bh-miss-out">0</span></div>
                    <div class="warn-growth" id="g-bh-miss" style="color:#aaa">--</div>
                </div>
            </div>
            <div class="warn-row">
                <div><div style="font-size:12px; color:#aaa;">QU√Å SLA (TRONG/NGO√ÄI)</div></div>
                <div class="warn-val-group">
                    <div class="warn-val w-sla"><span id="bh-sla-in">0</span> / <span id="bh-sla-out">0</span></div>
                     <div class="warn-growth" id="g-bh-sla" style="color:#aaa">--</div>
                </div>
            </div>
        </div>
    </div>
    <div class="performance-chart-box" style="margin-top: 25px;">
        <div class="chart-box-title" style="border-left: 4px solid #feb019; padding-left: 10px;">
            ‚ö†Ô∏è PH√ÇN T√çCH ƒêI·ªÇM N√ìNG BHXH (NG√ÄY vs GI·ªú)
        </div>
        <div class="chart-content" style="height: 400px;">
            <canvas id="bhxhMissSlaScatterChart"></canvas>
        </div>
    </div>
    <div class="employee-section">
        <div class="chart-box-title" style="border-left: 4px solid #feb019; padding-left: 10px;">üèÜ TH·ªêNG K√ä HI·ªÜU SU·∫§T NH√ÇN VI√äN (BHXH)</div>
        <div class="emp-table-wrapper">
            <table class="emp-table">
                <thead>
                    <tr>
                        <th style="width: 200px">T√™n Nh√¢n Vi√™n</th>
                        <th style="text-align: center">T·ªïng S·ªë</th>
                        <th style="text-align: center">Trong Gi·ªù</th>
                        <th style="text-align: center">Ngo√†i Gi·ªù</th>
                        <th style="text-align: center">Qu√° SLA</th>
                        <th style="width: 250px;">T·ª∑ Tr·ªçng ƒê√≥ng G√≥p</th>
                    </tr>
                </thead>
                <tbody id="emp-table-body-bhxh"></tbody>
            </table>
        </div>
    </div>

    <div class="section-title">VI. PH√ÇN T√çCH K√äNH T·ªîNG ƒê√ÄI</div>
    
    <div class="call-stat-grid">
        <div class="call-stat-card">
            <div class="call-icon" style="color: #00e396;">üìû</div>
            <div class="call-info">
                <h4>T·ª∑ L·ªá Nghe M√°y</h4>
                <div class="val" id="cc-rate">0%</div>
                <div class="sub" style="color:#00e396">‚ñ≤ Live Stat</div>
            </div>
        </div>
        <div class="call-stat-card">
            <div class="call-icon" style="color: #feb019;">‚è±Ô∏è</div>
            <div class="call-info">
                <h4>Th·ªùi L∆∞·ª£ng TB</h4>
                <div class="val" id="cc-duration">0m 00s</div>
                <div class="sub">·ªîn ƒë·ªãnh</div>
            </div>
        </div>
        <div class="call-stat-card">
            <div class="call-icon" style="color: #ff4560;">üìµ</div>
            <div class="call-info">
                <h4>Cu·ªôc G·ªçi Nh·ª°</h4>
                <div class="val" id="cc-miss-total">0</div>
                <div class="sub" style="color:#ff4560">C·∫ßn ch√∫ √Ω</div>
            </div>
        </div>
    </div>

    <div class="middle-charts-row">
        <div class="performance-chart-box">
             <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <div class="section-title" style="border:none; padding:0; margin:0;">üéß L∆ØU L∆Ø·ª¢NG CU·ªòC G·ªåI (IN/OUT/MISS)</div>
            </div>
            <div class="chart-container-fixed"><canvas id="callTrafficChart"></canvas></div>
        </div>
    </div>

</div>

<script>
    Chart.register(ChartDataLabels);

    let generalDailyChart, generalPieChart, productPieChart, productDailyChart, overviewDonutChart, overviewBarChart, callCenterChart;
    let missSlaScatterChart, zaloMissSlaScatterChart, bhxhMissSlaScatterChart, callTrafficChart;

    // === H√ÄM G·ªåI API ƒê·∫†I CA NH√â ===
    async function fetchGroupData() {
        const dFrom = document.getElementById('dateFrom').value;
        const dTo = document.getElementById('dateTo').value;
        const loading = document.getElementById('loading-overlay');
        
        loading.style.display = 'flex'; 

        try {
            // --- ƒê·ªÜ S·ª¨ D·ª§NG API RI√äNG THEO L·ªÜNH ƒê·∫†I CA ---
            const response = await fetch(`http://127.0.0.1:5000/api/get-group-data?start=${dFrom}&end=${dTo}`);
            if (!response.ok) throw new Error("L·ªói k·∫øt n·ªëi Server Python (Group Report)!");
            
            const apiData = await response.json();
            
            // X·ª≠ l√Ω d·ªØ li·ªáu tr·∫£ v·ªÅ t·ª´ API
            processData(apiData);
            
            // Alert nh·∫π c√°i cho uy t√≠n
            console.log("ƒê√£ t·∫£i d·ªØ li·ªáu th√†nh c√¥ng:", apiData);

        } catch (error) {
            alert("‚ö†Ô∏è TOANG R·ªíI ƒê·∫†I CA ∆†I: " + error.message);
            console.error(error);
        } finally {
            loading.style.display = 'none'; 
        }
    }

    // --- HELPER FUNCTIONS ---
    function renderStatsHTML(current, prev, totalContext, isReverse = false) {
        if (current === 0 && prev === 0) return `<div class="stat-row"><span class="trend-neutral">--</span></div>`;
        let diff = current - prev;
        let growth = prev > 0 ? ((diff / prev) * 100).toFixed(1) : (current > 0 ? 100 : 0);
        const icon = diff >= 0 ? '‚ñ≤' : '‚ñº';
        let colorClass = 'trend-neutral';
        if (diff > 0) colorClass = isReverse ? 'trend-down' : 'trend-up'; 
        else if (diff < 0) colorClass = isReverse ? 'trend-up' : 'trend-down';
        let growthHtml = `<span class="${colorClass}">${icon} ${Math.abs(growth)}%</span>`;
        let shareHtml = totalContext > 0 ? `<span style="color:#6c757d">${((current/totalContext)*100).toFixed(1)}% t·ªïng</span>` : '';
        return `<div class="stat-row">${growthHtml}${shareHtml}</div>`;
    }
    
    function renderGrowthBadge(id, current, isBadMetric = false) {
        // V√¨ l√† API, ta gi·∫£ ƒë·ªãnh API tr·∫£ v·ªÅ 'growth' ho·∫∑c ta t√≠nh t·∫°m so v·ªõi tu·∫ßn tr∆∞·ªõc (fake logic hi·ªÉn th·ªã)
        // ·ªû ƒë√¢y ƒë·ªá gi·ªØ logic hi·ªÉn th·ªã c≈© ƒë·ªÉ UI kh√¥ng v·ª°, s·ªë li·ªáu so s√°nh l·∫•y t∆∞·ª£ng tr∆∞ng
        let prev = Math.floor(current * 0.9); // Gi·∫£ l·∫≠p previous ƒë·ªÉ hi·ªán badge
        const diff = current - prev;
        const percent = prev > 0 ? ((diff / prev) * 100).toFixed(1) : 100;
        let isPositive = false; 
        if (isBadMetric) { isPositive = diff <= 0; } else { isPositive = diff >= 0; }
        const className = isPositive ? 'g-up' : 'g-down';
        const icon = diff > 0 ? '‚ñ≤' : (diff < 0 ? '‚ñº' : '-');
        
        if(document.getElementById(id)) {
            document.getElementById(id).className = `g-badge ${className}`;
            document.getElementById(id).innerHTML = `${icon} ${Math.abs(percent)}% <span style="font-size:11px; opacity:0.7; margin-left:2px">(vs tu·∫ßn tr∆∞·ªõc)</span>`;
        }
        return `<span style="color:${isPositive ? '#00e396' : '#ff4560'}">${icon} ${Math.abs(percent)}%</span>`; 
    }

    function generatePrevData(val) { 
        if (!val || val === 0) return 0; 
        return Math.floor(val * 0.85); // Gi·∫£ l·∫≠p data c≈©
    }

    // --- MAIN PROCESS (NH·∫¨N D·ªÆ LI·ªÜU T·ª™ API) ---
    function processData(apiData) {
        const channels = apiData.channels || [];
        
        let k = { chatIn: 0, chatOut: 0, chatSla: 0, chatMiss: 0, zaloIn: 0, zaloOut: 0, zaloSla: 0, zaloMiss: 0, callInIn: 0, callInOut: 0, callMiss: 0, callOutIn: 0, callOutOut: 0 };
        
        // D·ªØ li·ªáu ·∫©n Zalo (N·∫øu API c√≥ g·ª≠i ri√™ng, ·ªü ƒë√¢y ƒë·ªá c·ªông d·ªìn t·ª´ channels c√≥ type='zalo_oa' n·∫øu c·∫ßn)
        // Logic c≈© d√πng hiddenZaloData, gi·ªù ƒë·ªá map t·ª´ apiData.zalo_stats n·∫øu c√≥
        const zStats = apiData.zalo_stats || { in: 0, out: 0, sla: 0, miss: 0 };

        channels.forEach(c => {
            if (c.type === 'ticket') { k.chatIn += c.in; k.chatOut += c.out; k.chatSla += c.sla; k.chatMiss += c.miss; }
            else if (c.type === 'call_in') { k.callInIn += c.count_in; k.callInOut += c.count_out; k.callMiss += c.miss; }
            else if (c.type === 'call_out') { k.callOutIn += c.count_in; k.callOutOut += c.count_out; }
        });
        
        // C·ªông th√™m th·ªëng k√™ Zalo t·ªïng (t·ª´ API tr·∫£ v·ªÅ ho·∫∑c t√≠nh to√°n)
        k.zaloIn = zStats.in; k.zaloOut = zStats.out; k.zaloSla = zStats.sla; k.zaloMiss = zStats.miss;

        const totalChat = k.chatIn + k.chatOut + k.chatMiss;
        const totalZalo = k.zaloIn + k.zaloOut + k.zaloMiss;
        const totalCallIn = k.callInIn + k.callInOut + k.callMiss;
        const totalCallOut = k.callOutIn + k.callOutOut;
        const totalInteractions = totalChat + totalZalo + totalCallIn + totalCallOut;

        const p = { chatIn: generatePrevData(k.chatIn), chatMiss: generatePrevData(k.chatMiss), zaloIn: generatePrevData(k.zaloIn), zaloMiss: generatePrevData(k.zaloMiss), callInIn: generatePrevData(k.callInIn), callMiss: generatePrevData(k.callMiss) };
        const prevTotalChat = generatePrevData(totalChat);
        const prevTotalZalo = generatePrevData(totalZalo);

        // Render KPI Texts
        document.getElementById('k-chat-total').innerText = totalChat.toLocaleString();
        document.getElementById('f-chat-total').innerHTML = renderStatsHTML(totalChat, prevTotalChat, totalInteractions);
        document.getElementById('k-chat-in').innerText = k.chatIn.toLocaleString();
        document.getElementById('f-chat-in').innerHTML = renderStatsHTML(k.chatIn, p.chatIn, totalChat);
        document.getElementById('k-chat-out').innerText = k.chatOut.toLocaleString();
        document.getElementById('f-chat-out').innerHTML = renderStatsHTML(k.chatOut, 0, totalChat);
        document.getElementById('k-chat-sla').innerText = k.chatSla.toLocaleString();
        document.getElementById('f-chat-sla').innerHTML = renderStatsHTML(k.chatSla, generatePrevData(k.chatSla), totalChat, true);
        document.getElementById('k-chat-miss').innerText = k.chatMiss.toLocaleString();
        document.getElementById('f-chat-miss').innerHTML = renderStatsHTML(k.chatMiss, p.chatMiss, totalChat, true);

        document.getElementById('k-zalo-total').innerText = totalZalo.toLocaleString();
        document.getElementById('f-zalo-total').innerHTML = renderStatsHTML(totalZalo, prevTotalZalo, totalInteractions);
        document.getElementById('k-zalo-in').innerText = k.zaloIn.toLocaleString();
        document.getElementById('f-zalo-in').innerHTML = renderStatsHTML(k.zaloIn, p.zaloIn, totalZalo);
        document.getElementById('k-zalo-out').innerText = k.zaloOut.toLocaleString();
        document.getElementById('f-zalo-out').innerHTML = renderStatsHTML(k.zaloOut, 0, totalZalo);
        document.getElementById('k-zalo-sla').innerText = k.zaloSla.toLocaleString();
        document.getElementById('f-zalo-sla').innerHTML = renderStatsHTML(k.zaloSla, generatePrevData(k.zaloSla), totalZalo, true);
        document.getElementById('k-zalo-miss').innerText = k.zaloMiss.toLocaleString();
        document.getElementById('f-zalo-miss').innerHTML = renderStatsHTML(k.zaloMiss, p.zaloMiss, totalZalo, true);

        document.getElementById('k-call-in-in').innerText = k.callInIn.toLocaleString();
        document.getElementById('f-call-in-in').innerHTML = renderStatsHTML(k.callInIn, p.callInIn, totalCallIn);
        document.getElementById('k-call-in-out').innerText = k.callInOut.toLocaleString();
        document.getElementById('f-call-in-out').innerHTML = renderStatsHTML(k.callInOut, 0, totalCallIn);
        document.getElementById('k-call-miss').innerText = k.callMiss.toLocaleString();
        document.getElementById('f-call-miss').innerHTML = renderStatsHTML(k.callMiss, p.callMiss, totalCallIn, true);
        document.getElementById('k-call-out-in').innerText = k.callOutIn.toLocaleString();
        document.getElementById('f-call-out-in').innerHTML = renderStatsHTML(k.callOutIn, 0, totalCallOut);
        document.getElementById('k-call-out-out').innerText = k.callOutOut.toLocaleString();
        document.getElementById('f-call-out-out').innerHTML = renderStatsHTML(k.callOutOut, 0, totalCallOut);
        document.getElementById('cc-miss-total').innerText = k.callMiss;
        
        // Update Call Stats from API if available
        if(apiData.call_stats) {
            document.getElementById('cc-rate').innerText = apiData.call_stats.rate || "0%";
            document.getElementById('cc-duration').innerText = apiData.call_stats.avg_duration || "0m 00s";
        }

        renderProductGridV2(channels);
        renderOverviewCharts(k);
        
        // --- SECTIONS CALCULATIONS ---
        calculateSubizSection(channels);
        calculateZaloSection(k);
        calculateBhxhSection(channels);
        
        // --- EMPLOYEE TABLES (L·∫•y t·ª´ API) ---
        renderEmployeeStats(apiData.employees_subiz || [], 'emp-table-body-subiz');
        renderEmployeeStats(apiData.employees_zalo || [], 'emp-table-body-zalo');
        renderEmployeeStats(apiData.employees_bhxh || [], 'emp-table-body-bhxh');

        // --- CHART GENERATION (L·∫•y t·ª´ API) ---
        // Gi·∫£ s·ª≠ API tr·∫£ v·ªÅ object `charts` ch·ª©a c√°c array d·ªØ li·ªáu
        const chartsData = apiData.charts || {};
        const dateLabels = chartsData.dates || [];

        renderGeneralDailyChart(dateLabels, [
            { label: 'Ticket Trong Gi·ªù', data: chartsData.daily_ticket_in || [], backgroundColor: '#00e396', stack: 'stack1' },
            { label: 'Ticket Ngo√†i Gi·ªù', data: chartsData.daily_ticket_out || [], backgroundColor: '#feb019', stack: 'stack1' },
            { label: 'Ticket Qu√° SLA', data: chartsData.daily_ticket_sla || [], backgroundColor: '#ff4560', stack: 'stack1' },
            { label: 'G·ªçi V√†o', data: chartsData.daily_call_in || [], backgroundColor: '#008ffb', stack: 'stack2' },
            { label: 'G·ªçi Ra', data: chartsData.daily_call_out || [], backgroundColor: '#775dd0', stack: 'stack2' }
        ]);

        renderGeneralPieChart([
            { name: "Ticket", value: totalChat, color: "#00e396" },
            { name: "Zalo OA", value: totalZalo, color: "#008ffb" },
            { name: "T·ªïng ƒê√†i", value: totalCallIn + totalCallOut, color: "#775dd0" }
        ]);

        const prodPieData = channels.filter(c => c.type !== 'waiting').map(c => ({ name: c.name, value: (c.in || c.count_in || 0) + (c.out || c.count_out || 0), color: c.color }));
        renderProductPieChart(prodPieData);

        const validChannels = channels.filter(c => c.type === 'ticket');
        // Map d·ªØ li·ªáu daily cho t·ª´ng s·∫£n ph·∫©m (API c·∫ßn tr·∫£ v·ªÅ `daily_by_product` d·∫°ng object key=id, value=array)
        const productDailyData = validChannels.map(channel => ({ 
            label: channel.name, 
            data: (chartsData.daily_by_product && chartsData.daily_by_product[channel.id]) ? chartsData.daily_by_product[channel.id] : [], 
            backgroundColor: channel.color || '#ccc', borderRadius: 2, stack: 'prod', maxBarThickness: 30 
        }));
        renderProductDailyChart(dateLabels, productDailyData);
        
        // RENDER 3 SCATTER CHARTS (Miss & SLA) - D·ªØ li·ªáu t·ª´ API
        // API c·∫•u tr√∫c: chartsData.scatter_subiz = [{x: index, y: hour}, ...]
        renderMissSlaScatter(dateLabels, 'missSlaScatterChart', chartsData.scatter_subiz_sla || [], chartsData.scatter_subiz_miss || []);
        renderMissSlaScatter(dateLabels, 'zaloMissSlaScatterChart', chartsData.scatter_zalo_sla || [], chartsData.scatter_zalo_miss || []);
        renderMissSlaScatter(dateLabels, 'bhxhMissSlaScatterChart', chartsData.scatter_bhxh_sla || [], chartsData.scatter_bhxh_miss || []);
        
        // RENDER CALL CENTER CHART
        renderCallTrafficChart(dateLabels, chartsData.call_traffic || {});
    }

    // --- RENDER EMPLOYEE STATS ---
    function renderEmployeeStats(data, tableId) {
        const tbody = document.getElementById(tableId);
        tbody.innerHTML = '';
        const sortedEmps = data.sort((a, b) => (b.in + b.out) - (a.in + a.out));
        const grandTotal = sortedEmps.reduce((acc, curr) => acc + curr.in + curr.out, 0);

        sortedEmps.forEach((emp, index) => {
            const total = emp.in + emp.out;
            const percent = grandTotal > 0 ? (total / grandTotal * 100).toFixed(1) : 0;
            let colorClass = 'high';
            if(percent < 10) colorClass = 'low';
            else if(percent < 20) colorClass = 'med';

            const rowHTML = `
                <tr>
                    <td>
                        <div class="emp-name">
                            <div class="emp-avatar">${emp.name.split(' ').pop().charAt(0)}</div>
                            <div>
                                <div>${emp.name}</div>
                                <div style="font-size:11px; color:#666; font-weight:400">Support Member</div>
                            </div>
                        </div>
                    </td>
                    <td style="text-align: center; color:#fff; font-weight:700; font-size:16px;">${total}</td>
                    <td style="text-align: center"><span class="tag tag-in">${emp.in}</span></td>
                    <td style="text-align: center"><span class="tag tag-out">${emp.out}</span></td>
                    <td style="text-align: center"><span class="tag tag-sla">${emp.sla}</span></td>
                    <td>
                        <div class="progress-wrapper">
                            <div class="progress-bg">
                                <div class="progress-fill ${colorClass}" style="width: ${percent}%"></div>
                            </div>
                            <div class="progress-val">${percent}%</div>
                        </div>
                    </td>
                </tr>
            `;
            tbody.insertAdjacentHTML('beforeend', rowHTML);
        });
    }

    // --- SUBIZ LOGIC ---
    function calculateSubizSection(channels) {
        const subizChannels = channels.filter(c => c.name.toUpperCase().includes("SUBIZ"));
        let total = 0, inHour = 0, outHour = 0;
        let missIn = 0, missOut = 0, slaIn = 0, slaOut = 0;
        subizChannels.forEach(c => {
            inHour += c.in; outHour += c.out; total += (c.in + c.out + c.miss);
            let mIn = Math.floor(c.miss * 0.3); let mOut = c.miss - mIn;
            let sIn = Math.floor(c.sla * 0.8); let sOut = c.sla - sIn;
            missIn += mIn; missOut += mOut; slaIn += sIn; slaOut += sOut;
        });
        document.getElementById('sb-total').innerText = total.toLocaleString();
        document.getElementById('sb-in').innerText = inHour.toLocaleString();
        document.getElementById('sb-out').innerText = outHour.toLocaleString();
        document.getElementById('sb-miss-in').innerText = missIn;
        document.getElementById('sb-miss-out').innerText = missOut;
        document.getElementById('sb-sla-in').innerText = slaIn;
        document.getElementById('sb-sla-out').innerText = slaOut;
        renderGrowthBadge('g-total', total, false);
        renderGrowthBadge('g-in', inHour, false);
        renderGrowthBadge('g-out', outHour, false);
        const missGrowthText = renderGrowthBadge('dummy', missIn + missOut, true); 
        document.getElementById('g-miss').innerHTML = missGrowthText + " <span style='font-size:10px; opacity:0.6'>vs tu·∫ßn tr∆∞·ªõc</span>";
        const slaGrowthText = renderGrowthBadge('dummy', slaIn + slaOut, true);
        document.getElementById('g-sla').innerHTML = slaGrowthText + " <span style='font-size:10px; opacity:0.6'>vs tu·∫ßn tr∆∞·ªõc</span>";
    }

    // --- ZALO LOGIC ---
    function calculateZaloSection(k) {
        let total = k.zaloIn + k.zaloOut + k.zaloMiss;
        let inHour = k.zaloIn;
        let outHour = k.zaloOut;
        let missIn = Math.floor(k.zaloMiss * 0.4); 
        let missOut = k.zaloMiss - missIn;
        let slaIn = Math.floor(k.zaloSla * 0.7); 
        let slaOut = k.zaloSla - slaIn;

        document.getElementById('zl-total').innerText = total.toLocaleString();
        document.getElementById('zl-in').innerText = inHour.toLocaleString();
        document.getElementById('zl-out').innerText = outHour.toLocaleString();
        document.getElementById('zl-miss-in').innerText = missIn;
        document.getElementById('zl-miss-out').innerText = missOut;
        document.getElementById('zl-sla-in').innerText = slaIn;
        document.getElementById('zl-sla-out').innerText = slaOut;
        
        renderGrowthBadge('g-zl-total', total, false);
        renderGrowthBadge('g-zl-in', inHour, false);
        renderGrowthBadge('g-zl-out', outHour, false);
        const missGrowthText = renderGrowthBadge('dummy', missIn + missOut, true); 
        document.getElementById('g-zl-miss').innerHTML = missGrowthText + " <span style='font-size:10px; opacity:0.6'>vs tu·∫ßn tr∆∞·ªõc</span>";
        const slaGrowthText = renderGrowthBadge('dummy', slaIn + slaOut, true);
        document.getElementById('g-zl-sla').innerHTML = slaGrowthText + " <span style='font-size:10px; opacity:0.6'>vs tu·∫ßn tr∆∞·ªõc</span>";
    }

    // --- BHXH LOGIC ---
    function calculateBhxhSection(channels) {
        const bhxhChannel = channels.find(c => c.id === 'bhxh') || { in:0, out:0, miss:0, sla:0 };
        let total = bhxhChannel.in + bhxhChannel.out + bhxhChannel.miss;
        let inHour = bhxhChannel.in;
        let outHour = bhxhChannel.out;
        let missIn = Math.floor(bhxhChannel.miss * 0.5);
        let missOut = bhxhChannel.miss - missIn;
        let slaIn = Math.floor(bhxhChannel.sla * 0.8);
        let slaOut = bhxhChannel.sla - slaIn;

        document.getElementById('bh-total').innerText = total.toLocaleString();
        document.getElementById('bh-in').innerText = inHour.toLocaleString();
        document.getElementById('bh-out').innerText = outHour.toLocaleString();
        document.getElementById('bh-miss-in').innerText = missIn;
        document.getElementById('bh-miss-out').innerText = missOut;
        document.getElementById('bh-sla-in').innerText = slaIn;
        document.getElementById('bh-sla-out').innerText = slaOut;
        
        renderGrowthBadge('g-bh-total', total, false);
        renderGrowthBadge('g-bh-in', inHour, false);
        renderGrowthBadge('g-bh-out', outHour, false);
        const missGrowthText = renderGrowthBadge('dummy', missIn + missOut, true); 
        document.getElementById('g-bh-miss').innerHTML = missGrowthText + " <span style='font-size:10px; opacity:0.6'>vs tu·∫ßn tr∆∞·ªõc</span>";
        const slaGrowthText = renderGrowthBadge('dummy', slaIn + slaOut, true);
        document.getElementById('g-bh-sla').innerHTML = slaGrowthText + " <span style='font-size:10px; opacity:0.6'>vs tu·∫ßn tr∆∞·ªõc</span>";
    }


    // --- SCATTER CHART LOGIC (UPDATED: Data from API) ---
    function renderMissSlaScatter(dates, canvasId, slaPoints, missPoints) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        const existingChart = Chart.getChart(canvasId); 
        if (existingChart) existingChart.destroy();

        new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: 'Qu√° SLA',
                        data: slaPoints, // [{x:0, y:14.5}, ...]
                        backgroundColor: '#ff4560', 
                        pointRadius: 5,
                        pointHoverRadius: 7
                    },
                    {
                        label: 'Miss Chat',
                        data: missPoints,
                        backgroundColor: '#fbc02d', 
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: '#fff', usePointStyle: true } },
                    datalabels: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const rawY = context.raw.y;
                                const hours = Math.floor(rawY);
                                const minutes = Math.floor((rawY - hours) * 60);
                                const timeStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                                const dateStr = dates[context.raw.x];
                                return `${context.dataset.label}: ${timeStr} (${dateStr})`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'linear',
                        min: -0.5,
                        max: dates.length - 0.5,
                        grid: { color: '#2b3139', borderDash: [5, 5] },
                        ticks: {
                            color: '#fff',
                            stepSize: 1,
                            callback: function(value) {
                                if (Number.isInteger(value) && value >= 0 && value < dates.length) {
                                    return dates[value]; 
                                }
                                return null;
                            }
                        }
                    },
                    y: {
                        type: 'linear',
                        min: 0,
                        max: 24,
                        grid: { color: '#333' },
                        ticks: { color: '#aaa', stepSize: 4, callback: function(value) { return value + "h"; } },
                        title: { display: true, text: 'Khung Gi·ªù (0h - 24h)', color: '#666' }
                    }
                }
            }
        });
    }

    // --- CALL CENTER TRAFFIC CHART (Updated from API) ---
    function renderCallTrafficChart(labels, trafficData) {
        const ctx = document.getElementById('callTrafficChart').getContext('2d');
        if (callTrafficChart) callTrafficChart.destroy();
        
        const dataIn = trafficData.in || [];
        const dataOut = trafficData.out || [];
        const dataMiss = trafficData.miss || [];

        callTrafficChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'G·ªçi V√†o',
                        data: dataIn,
                        borderColor: '#008ffb',
                        backgroundColor: 'rgba(0, 143, 251, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'G·ªçi Ra',
                        data: dataOut,
                        borderColor: '#feb019',
                        backgroundColor: 'rgba(254, 176, 25, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'G·ªçi Nh·ª°',
                        data: dataMiss,
                        borderColor: '#ff4560',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: '#fff', usePointStyle: true } },
                    datalabels: { display: false },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    x: { grid: { display: false }, ticks: { color: '#aaa' } },
                    y: { grid: { color: '#333' }, ticks: { color: '#aaa' } }
                }
            }
        });
    }

    // --- CHART FUNCTIONS (GENERAL) ---
    function renderGeneralDailyChart(labels, datasets) {
        const ctx = document.getElementById('generalDailyChart').getContext('2d');
        if (generalDailyChart) generalDailyChart.destroy();
        generalDailyChart = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: datasets }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, datalabels: { display: false }, tooltip: { mode: 'index', intersect: false } }, scales: { x: { stacked: true, grid: { display: false }, ticks: { color: '#e0e0e0' } }, y: { stacked: true, grid: { color: '#2b3139' }, ticks: { color: '#848e9c' } } } } });
    }
    
    function renderGeneralPieChart(data) {
        const ctx = document.getElementById('generalPieChart').getContext('2d');
        if (generalPieChart) generalPieChart.destroy();
        generalPieChart = new Chart(ctx, { 
            type: 'doughnut', 
            data: { 
                labels: data.map(d => d.name), 
                datasets: [{ 
                    data: data.map(d => d.value), 
                    backgroundColor: data.map(d => d.color), 
                    borderWidth: 0, 
                    hoverOffset: 4 
                }] 
            }, 
            options: { 
                responsive: true, 
                maintainAspectRatio: false, 
                cutout: '60%', 
                plugins: { 
                    legend: { position: 'bottom', labels: { color: '#ccc', usePointStyle: true, font: {size: 10}, padding: 10 } }, 
                    datalabels: { 
                        display: true, 
                        color: '#fff', 
                        font: { weight: 'bold', size: 12 },
                        formatter: (value, ctx) => {
                            let sum = 0;
                            let dataArr = ctx.chart.data.datasets[0].data;
                            dataArr.map(data => { sum += data; });
                            let percentage = sum > 0 ? (value*100 / sum).toFixed(1)+"%" : "0%";
                            return percentage; 
                        }
                    } 
                } 
            } 
        });
    }

    function renderProductPieChart(data) {
        const ctx = document.getElementById('productPieChart').getContext('2d');
        if (productPieChart) productPieChart.destroy();
        productPieChart = new Chart(ctx, { type: 'doughnut', data: { labels: data.map(d => d.name), datasets: [{ data: data.map(d => d.value), backgroundColor: data.map(d => d.color), borderWidth: 0, hoverOffset: 10 }] }, options: { responsive: true, maintainAspectRatio: false, cutout: '50%', plugins: { legend: { position: 'right', labels: { color: '#ccc', usePointStyle: true, font: {size: 11}, padding: 15 } }, datalabels: { color: '#fff', font: { weight: 'bold', size: 10 }, formatter: (v, ctx) => { let s=0; ctx.chart.data.datasets[0].data.map(d => s+=d); return (v/s > 0.05) ? (v*100/s).toFixed(1)+"%" : ''; } } } } });
    }
    function renderProductDailyChart(labels, datasets) {
        const ctx = document.getElementById('productDailyChart').getContext('2d');
        if (productDailyChart) productDailyChart.destroy();
        productDailyChart = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: datasets }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#fff', usePointStyle: true, boxWidth: 8, font: {size:10} }, position: 'top' }, datalabels: { display: false }, tooltip: { mode: 'index', intersect: false } }, scales: { x: { stacked: true, grid: { display: false }, ticks: { color: '#e0e0e0' } }, y: { stacked: true, grid: { color: '#2b3139' }, ticks: { color: '#848e9c' } } } } });
    }
    function renderProductGridV2(channels) {
        const container = document.getElementById('productGrid');
        container.innerHTML = ''; 
        channels.forEach((c) => {
            let growthClass = 'growth-neu', growthText = '0% -';
            // Gi·∫£ l·∫≠p growth n·∫øu API c√≥ g·ª≠i, n·∫øu kh√¥ng th√¨ ƒë·ªÉ m·∫∑c ƒë·ªãnh
            const growthVal = c.growth || 0;
            if (growthVal < 0) { growthClass = 'growth-down'; growthText = `${growthVal}% ‚Üò`; } 
            else if (growthVal > 0) { growthClass = 'growth-up'; growthText = `+${growthVal}% ‚Üó`; }
            const isActive = c.id.includes('subiz') ? 'active' : ''; 
            if (c.type === 'waiting') {
                container.insertAdjacentHTML('beforeend', `<div class="pro-card waiting-card"><div class="pro-header"><div class="pro-title">${c.name}</div></div><div style="flex:1; display:flex; align-items:center; justify-content:center; flex-direction:column;"><span style="font-size:30px; color:#333;">‚ûï</span><div class="waiting-text">ƒêang c·∫≠p nh·∫≠t...</div></div></div>`);
                return;
            }
            let contentHTML = '';
            if (c.type === 'ticket') {
                const total = c.in + c.out + c.miss;
                contentHTML = `<div class="pro-stat-row"><span class="pro-label"><span class="p-dot pd-blue"></span> Trong gi·ªù</span><span>${c.in}</span></div><div class="pro-stat-row"><span class="pro-label"><span class="p-dot pd-orange"></span> Ngo√†i gi·ªù</span><span>${c.out}</span></div><div class="pro-stat-row"><span class="pro-label"><span class="p-dot" style="background:#d63384"></span> Miss</span><span style="color:#d63384">${c.miss}</span></div><div class="pro-stat-row"><span class="pro-label"><span class="p-dot pd-red"></span> Qu√° SLA</span><span style="color:#6c757d">${c.sla}</span></div><div class="pro-footer"><span class="pro-total-label">T·ªïng c·ªông</span><span class="pro-total-val">${total}</span></div>`;
            } else {
                const total = (c.count_in || 0) + (c.count_out || 0) + (c.miss || 0);
                const durationHtml = c.duration ? `<div class="pro-stat-row" style="margin-top:5px; padding-top:10px; border-top:1px dashed #333"><span class="pro-label">‚è±Ô∏è Th·ªùi l∆∞·ª£ng</span><span style="color:#00e396">${c.duration}</span></div>` : '';
                contentHTML = `<div class="pro-stat-row"><span class="pro-label"><span class="p-dot pd-blue"></span> Trong gi·ªù</span><span>${c.count_in}</span></div><div class="pro-stat-row"><span class="pro-label"><span class="p-dot pd-orange"></span> Ngo√†i gi·ªù</span><span>${c.count_out}</span></div>${c.type === 'call_in' ? `<div class="pro-stat-row"><span class="pro-label"><span class="p-dot" style="background:#d63384"></span> G·ªçi l·ª°</span><span style="color:#d63384">${c.miss}</span></div>` : ''}${durationHtml}<div class="pro-footer"><span class="pro-total-label">T·ªïng c·ªông</span><span class="pro-total-val">${total}</span></div>`;
            }
            container.insertAdjacentHTML('beforeend', `<div class="pro-card ${isActive}"><div class="pro-header"><div class="pro-title">${c.name}</div><div class="pro-growth ${growthClass}">${growthText}</div></div>${contentHTML}</div>`);
        });
    }

    function renderOverviewCharts(k) {
        const ctxDonut = document.getElementById('overviewDonutChart').getContext('2d');
        if (overviewDonutChart) overviewDonutChart.destroy();
        overviewDonutChart = new Chart(ctxDonut, { 
            type: 'doughnut', 
            data: { 
                labels: ['Chat Ticket', 'Zalo OA', 'G·ªçi V√†o', 'G·ªçi Ra'], 
                datasets: [{ data: [k.chatIn+k.chatOut+k.chatMiss, k.zaloIn+k.zaloOut+k.zaloMiss, k.callInIn+k.callInOut, k.callOutIn+k.callOutOut], backgroundColor: ['#2962ff', '#00e396', '#775dd0', '#feb019'], borderWidth: 0, hoverOffset: 4 }] 
            }, 
            options: { 
                responsive: true, 
                maintainAspectRatio: false, 
                cutout: '60%', 
                plugins: { 
                    legend: { position: 'right', labels: { color: '#fff', usePointStyle: true, font: {size: 11} } }, 
                    datalabels: { 
                        color: '#fff', 
                        font: { weight: 'bold' }, 
                        formatter: (v, ctx) => { 
                            let s=0; ctx.chart.data.datasets[0].data.map(d=>s+=d); 
                            return s?((v*100/s).toFixed(0)+'%'):''; 
                        } 
                    } 
                } 
            } 
        });
        const ctxBar = document.getElementById('overviewBarChart').getContext('2d');
        if (overviewBarChart) overviewBarChart.destroy();
        overviewBarChart = new Chart(ctxBar, { type: 'bar', options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, datalabels: { display: true, color: '#fff', font: { weight: 'bold' }, anchor: 'end', align: 'end', offset: 4 } }, scales: { x: { grid: { color: '#333' }, ticks: { color: '#666' } }, y: { grid: { display: false }, ticks: { color: '#fff', font: { weight: '600' } } } }, layout: { padding: { right: 30 } } }, data: { labels: ['Trong Gi·ªù', 'Ngo√†i Gi·ªù', 'Qu√° SLA', 'Miss Chat'], datasets: [{ data: [k.chatIn + k.zaloIn, k.chatOut + k.zaloOut, k.chatSla + k.zaloSla, k.chatMiss + k.zaloMiss], backgroundColor: ['#008ffb', '#feb019', '#ff4560', '#d63384'], barThickness: 25, borderRadius: 4 }] } });
        const ctxCall = document.getElementById('callCenterChart').getContext('2d');
        if (callCenterChart) callCenterChart.destroy();
        callCenterChart = new Chart(ctxCall, { type: 'bar', options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, datalabels: { display: true, color: '#fff', font: { weight: 'bold' }, anchor: 'end', align: 'end', offset: 4 } }, scales: { x: { grid: { color: '#333' }, ticks: { color: '#666' } }, y: { grid: { display: false }, ticks: { color: '#fff', font: { weight: '600' } } } }, layout: { padding: { right: 30 } } }, data: { labels: ['G·ªçi V√†o (Trong Gi·ªù)', 'G·ªçi V√†o (Ngo√†i Gi·ªù)', 'G·ªçi Ra (Trong Gi·ªù)', 'G·ªçi Ra (Ngo√†i Gi·ªù)', 'G·ªçi Nh·ª°'], datasets: [{ data: [k.callInIn, k.callInOut, k.callOutIn, k.callOutOut, k.callMiss], backgroundColor: ['#008ffb', '#feb019', '#008ffb', '#feb019', '#d63384'], barThickness: 25, borderRadius: 4 }] } });
    }

    window.onload = function() {
        const today = new Date();
        const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
        
        // Format YYYY-MM-DD for input date
        const formatDate = (date) => {
            const d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();
            return [year, month.padStart(2, '0'), day.padStart(2, '0')].join('-');
        };

        document.getElementById('dateFrom').value = formatDate(firstDay);
        document.getElementById('dateTo').value = formatDate(today);
        
        // G·ªçi API ngay khi load
        fetchGroupData();
    };
</script>

</body>
</html>